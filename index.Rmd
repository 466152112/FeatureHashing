---
title       : Introduction of Feature Hashing
subtitle    : Creates a Model Matrix via Feature Hashing With a Formula Interface
author      : Wush Wu
job         : Taiwan R User Group
framework   : io2012-wush
highlighter : highlight.js
hitheme     : zenburn
widgets     : [mathjax]            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
knit        : slidify::knit2slides
---

```{r setup, include=FALSE, cache=FALSE}
suppressPackageStartupMessages({
  library(knitr)
  library(ggplot2)
})
opts_chunk$set(echo = FALSE, cache = FALSE)
```

## Outline

1. Feature Vectorization in R
1. Distributed Feature Vectorization in R
1. Handling New Feature
1. Feature Hashing
1. Linear Regression with Feature Hashing
1. Logistic Regression with Feature Hashing
1. Gradient Boosted Decision Tree with Feature Hashing

--- .segue .dark

## Feature Vectorization in R

--- &vcenter .largecontent

## Feature Vectorization

- Lots of machine learning algorithm involves numerical matrix
    - Linear Regression
    - Logistic Regression
    - Support Vector Machine
    - Decision Tree

--- &vcenter .largecontent

## Linear Regression

```{r lr, cache = TRUE}
# http://stackoverflow.com/questions/7549694/ggplot2-adding-regression-line-equation-and-r2-on-graph
df <- data.frame(x = c(1:100))
df$y <- 2 + 3 * df$x + rnorm(100, sd = 40)
p <- ggplot(data = df, aes(x = x, y = y)) +
            geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) +
            geom_point()
lm_eqn = function(df){
    m = lm(y ~ x, df);
    eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2, 
         list(a = format(coef(m)[1], digits = 2), 
              b = format(coef(m)[2], digits = 2), 
             r2 = format(summary(m)$r.squared, digits = 3)))
    as.character(as.expression(eq));                 
}
g <- lm(y ~ ., df)
p + geom_text(aes(x = 25, y = 300, label = lm_eqn(df)), parse = TRUE)
```

--- &vcenter .largecontent

## Linear Regression

- Fitting

$$X_1 = \begin{bmatrix}
1 & 1\\
1 & 2\\
1 & 3\\
\vdots \end{bmatrix},
y = \begin{bmatrix}
`r df$y[1]`\\
`r df$y[2]`\\
`r df$y[3]`\\
\vdots \end{bmatrix}$$

$$\hat{\beta} = \begin{bmatrix}
`r format(coef(g)[1], digits = 2)`\\
`r format(coef(g)[2], digits = 2)` \end{bmatrix}
= (X_1^T X_1)^{-1}X_1 y$$

--- &vcenter .largecontent

## Linear Regression

- Predicting

$$X_2 \hat{\beta}$$

--- &vcenter .largecontent

## In General, We Want ...

```{r hope, echo=TRUE, eval=FALSE}
...
X1 <- get_matrix(data1)
g <- get_model(y, X1)
X2 <- get_matrix(data2)
predict(g, X2)
```

--- &vcenter .largecontent

## IPinYou Dataset

- A Competition of Real Time Bidding in 2013

<http://data.computational-advertising.org/>

```{r load_ipinyou, echo=FALSE, results='asis', cache=TRUE}
suppressPackageStartupMessages({
  library(bit64)
  library(data.table)
  library(magrittr)
  library(xtable)
})
suppressWarnings({
  imp.20130606 <- fread("imp.20130606.part.txt", sep = "\t", select = c(2, 6, 24), colClasses = "character") %>% `colnames<-`(c("time", "ip", "usertag")) %>% `[`(2:6)
  imp.20130607 <- fread("imp.20130607.part.txt", sep = "\t", select = c(2, 6, 24), colClasses = "character") %>% `colnames<-`(c("time", "ip", "usertag")) %>% `[`(2:4)
})
print.xtable(xtable(imp.20130606), type = "html")
```

--- &vcenter .largecontent

## Model Matrix

```{r model.matrix.echo1, echo=TRUE, eval=FALSE}
m1 <- model.matrix(~ ip, imp.20130606)
```

```{r model.matrix1, echo=FALSE, dependson="load_ipinyou", results='asis'}
library(xtable)
print.xtable(xtable(model.matrix(~ ip, imp.20130606), digits = 0), type = "html")
```

--- &vcenter .largecontent

## Model Matrix

```{r model.matrix.echo2, echo=TRUE, eval=FALSE}
m2 <- model.matrix(~ ip, imp.20130607)
```

```{r model.matrix2, echo=FALSE, dependson="load_ipinyou", results='asis'}
library(xtable)
print.xtable(xtable(model.matrix(~ ip, imp.20130607), digits = 0), type = "html")
```

--- &vcenter .largecontent

## Model Matrix

- `m1` has 5 columns
- `m2` has 3 columns

### Synchronization is required!

--- &vcenter .largecontent

--- .segue .dark

## Distributed Feature Vectorization in R



--- .segue .dark

## Handling New Feature

--- .segue .dark

## Feature Hashing

--- .segue .dark

## Linear Regression with Feature Hashing

--- .segue .dark

## Logistic Regression with Feature Hashing

--- .segue .dark

## Gradient Boosted Decision Tree with Feature Hashing
